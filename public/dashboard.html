<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dashboard - Live Status & Video</title>
<style>
body{font-family:Arial;background:#0c1515;color:white;padding:20px;}
h2{margin-bottom:10px;}
.userCard{margin-bottom:20px;border:1px solid #444;padding:10px;border-radius:10px;}
video{width:300px;height:200px;background:#000;border-radius:8px;display:block;margin-bottom:5px;}
img{width:50px;height:50px;border-radius:50%;display:block;margin-bottom:5px;}
.online{color:#0f0;}
.offline{color:#f00;}
input,button{padding:5px;margin:2px 0;}
</style>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<h2>Live Dashboard</h2>
<div id="usersContainer"></div>

<script>
const socket = io();
const allowedNumbers = ['13058962443','18573917861'];
const usersContainer = document.getElementById('usersContainer');
let myStream;

// Ask dashboard number
let myNumber = prompt("Enter your number for dashboard (13058962443 or 18573917861)");
if(!allowedNumbers.includes(myNumber)) alert("Number not allowed");

// Get local video stream (optional, dashboard own camera)
navigator.mediaDevices.getUserMedia({video:true,audio:false}).then(stream=>{myStream=stream;}).catch(e=>console.log(e));

function renderUsers(users){
  usersContainer.innerHTML = '';
  allowedNumbers.forEach(num=>{
    const div = document.createElement('div'); div.className='userCard';
    const isOnline = users[num] ? true : false;
    const status = isOnline ? 'Online' : 'Offline';
    const statusClass = isOnline ? 'online':'offline';
    const photo = users[num] && users[num].photo ? users[num].photo : '';
    const videoStatus = users[num] && users[num].videoStatus ? users[num].videoStatus : '';

    div.innerHTML = `
      <strong>${num}</strong> - <span class="${statusClass}">${status}</span><br>
      <img src="${photo}" alt="Profile"/><br>
      ${videoStatus ? `<video src="${videoStatus}" controls></video>` : ''}
      <input type="file" id="upload${num}" accept="image/*,video/*"/>
      <button onclick="uploadFile('${num}')">Upload Photo/Video</button>
    `;
    usersContainer.appendChild(div);
  });
}

function uploadFile(number){
  const input = document.getElementById('upload'+number);
  if(!input.files.length) return alert("Select file first");
  const file = input.files[0];
  const form = new FormData();
  form.append('file', file);
  form.append('number', number);
  form.append('type', file.type.startsWith('video') ? 'video' : 'photo');
  fetch('/upload', {method:'POST', body:form})
  .then(res=>res.json()).then(res=>{
    if(res.success) alert("Uploaded successfully");
  });
}

// Update live status when server sends info
socket.on('statusUpdate', users=>{
  renderUsers(users);
});

// Join as dashboard observer (optional)
socket.emit('join', myNumber);
</script>
</body>
</html>
