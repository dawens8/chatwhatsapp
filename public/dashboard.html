<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Live Status & Media</title>
<style>
body{font-family:Arial; background:#0c1515; color:white; padding:20px;}
h2{margin-bottom:10px;}
.userCard{margin-bottom:20px; border:1px solid #444; padding:10px; border-radius:10px;}
video, img{width:300px; height:200px; background:#000; border-radius:8px; display:block; margin-bottom:5px;}
.online{color:#0f0;}
.offline{color:#f00;}
button{margin:5px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer;}
</style>
<script src="/socket.io/socket.io.js"></script>
</head>
<body>
<h2>Live Status Dashboard</h2>
<div id="usersContainer"></div>

<script>
const socket = io();
const allowedNumbers = ['13058962443','18573917861'];
const usersContainer = document.getElementById('usersContainer');

let myNumber = prompt("Enter your dashboard number (13058962443 or 18573917861)");

function renderUsers(users){
  usersContainer.innerHTML='';
  allowedNumbers.forEach(num=>{
    const div = document.createElement('div');
    div.className='userCard';
    const status = users[num] && users[num].socketId? 'Online':'Offline';
    const photo = users[num] && users[num].photo? users[num].photo:'https://via.placeholder.com/300x200?text=Photo';
    const video = users[num] && users[num].video? users[num].video:'';
    div.innerHTML=`<h4>${num} - <span class="${users[num]&&users[num].socketId?'online':'offline'}">${status}</span></h4>
      <img id="photo-${num}" src="${photo}" alt="Photo"/>
      ${video? `<video src="${video}" controls></video>`:''}
      <input type="file" id="uploadPhoto-${num}" accept="image/*"/>
      <button onclick="uploadPhoto('${num}')">Upload Photo</button>
      <input type="file" id="uploadVideo-${num}" accept="video/*"/>
      <button onclick="uploadVideo('${num}')">Upload Video</button>
    `;
    usersContainer.appendChild(div);
  });
}

function uploadPhoto(number){
  const fileInput = document.getElementById('uploadPhoto-'+number);
  if(fileInput.files.length===0) return;
  const formData = new FormData();
  formData.append('photo', fileInput.files[0]);
  formData.append('number', number);
  fetch('/uploadPhoto', {method:'POST', body:formData}).then(res=>res.json()).then(res=>{
    if(res.success) alert('Photo updated');
  });
}

function uploadVideo(number){
  const fileInput = document.getElementById('uploadVideo-'+number);
  if(fileInput.files.length===0) return;
  const formData = new FormData();
  formData.append('video', fileInput.files[0]);
  formData.append('number', number);
  fetch('/uploadVideo', {method:'POST', body:formData}).then(res=>res.json()).then(res=>{
    if(res.success) alert('Video updated');
  });
}

// live updates
socket.on('statusUpdate', users=>{
  renderUsers(users);
});
socket.on('photoUpdated', data=>{
  const img = document.getElementById('photo-'+data.number);
  if(img) img.src = data.photo;
});
socket.on('videoUpdated', data=>{
  renderUsers({}); // re-render all to show video
});
</script>
</body>
</html>
